<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BioPurifyTech - Biogas Purification System</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Animated Background Particles */
        .particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
        }

        .particle {
            position: absolute;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            animation: float 6s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(180deg); }
        }

        /* Login Page Styles */
        .login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }

        .login-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.25);
            width: 400px;
            transform: translateY(50px);
            opacity: 0;
            animation: slideIn 1s ease-out forwards;
        }

        @keyframes slideIn {
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .logo {
            text-align: center;
            margin-bottom: 30px;
        }

        .logo h1 {
            color: #27ae60;
            font-size: 2.5em;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #27ae60, #2ecc71);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .logo p {
            color: #666;
            font-size: 1.1em;
        }

        .form-group {
            margin-bottom: 25px;
            position: relative;
        }

        .form-group input {
            width: 100%;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.8);
        }

        .form-group input:focus {
            outline: none;
            border-color: #27ae60;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(39, 174, 96, 0.3);
        }

        .form-group label {
            position: absolute;
            top: 15px;
            left: 15px;
            color: #666;
            transition: all 0.3s ease;
            pointer-events: none;
        }

        .form-group input:focus + label,
        .form-group input:valid + label {
            top: -10px;
            left: 10px;
            font-size: 12px;
            color: #27ae60;
            background: white;
            padding: 0 5px;
        }

        .login-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #27ae60, #2ecc71);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .login-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(39, 174, 96, 0.4);
        }

        .login-btn:active {
            transform: translateY(0);
        }

        .error-message {
            color: #e74c3c;
            text-align: center;
            margin-top: 15px;
            padding: 10px;
            border-radius: 5px;
            background: rgba(231, 76, 60, 0.1);
            display: none;
            animation: shake 0.5s ease-in-out;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        /* Dashboard Styles */
        .dashboard {
            display: none;
            padding: 20px;
            animation: fadeIn 1s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .dashboard-header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .dashboard-title {
            color: #27ae60;
            font-size: 2em;
            font-weight: bold;
        }

        .exit-btn {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .exit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(231, 76, 60, 0.4);
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
        }

        .card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
        }

        .card-title {
            font-size: 1.4em;
            color: #333;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .status-value {
            font-size: 2.5em;
            font-weight: bold;
            color: #27ae60;
            text-align: center;
            margin: 20px 0;
            animation: countUp 2s ease-out;
        }

        @keyframes countUp {
            from { transform: scale(0.5); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        .chart-container {
            position: relative;
            height: 250px;
            margin-top: 20px;
        }

        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
            animation: blink 2s infinite;
        }

        .status-online {
            background: #2ecc71;
        }

        .status-warning {
            background: #f39c12;
        }

        .status-error {
            background: #e74c3c;
        }

        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0.3; }
        }

        .comparison-container {
            display: flex;
            justify-content: space-around;
            align-items: center;
            margin: 20px 0;
        }

        .comparison-item {
            text-align: center;
            flex: 1;
        }

        .comparison-value {
            font-size: 2em;
            font-weight: bold;
            margin: 10px 0;
        }

        .comparison-before {
            color: #e74c3c;
        }

        .comparison-after {
            color: #2ecc71;
        }

        .comparison-arrow {
            font-size: 2em;
            color: #27ae60;
            margin: 0 20px;
        }

        /* Loading Animation */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(39, 174, 96, 0.3);
            border-radius: 50%;
            border-top-color: #27ae60;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
            
            .login-card {
                width: 90%;
                padding: 30px 20px;
            }
            
            .dashboard-header {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }
        }
    </style>
</head>
<body>
    <!-- Animated Background Particles -->
    <div class="particles" id="particles"></div>

    <!-- Login Page -->
    <div id="loginPage" class="login-container">
        <div class="login-card">
            <div class="logo">
                <h1>BioPurifyTech</h1>
                <p>Biogas Purification System</p>
            </div>
            <form id="loginForm">
                <div class="form-group">
                    <input type="text" id="username" required>
                    <label for="username">Username</label>
                </div>
                <div class="form-group">
                    <input type="password" id="password" required>
                    <label for="password">Password</label>
                </div>
                <button type="submit" class="login-btn">
                    <span id="loginText">Login to System</span>
                    <div class="loading" id="loginLoading" style="display: none;"></div>
                </button>
                <div class="error-message" id="errorMessage"></div>
            </form>
        </div>
    </div>

    <!-- Dashboard Page -->
    <div id="dashboardPage" class="dashboard">
        <div class="dashboard-header">
            <h1 class="dashboard-title">BioPurifyTech Dashboard</h1>
            <button class="exit-btn" onclick="logout()">
                <span>🚪</span> Exit
            </button>
        </div>

        <div class="dashboard-grid">
            <!-- CO2 Monitoring -->
            <div class="card">
                <h3 class="card-title">
                    <span class="status-indicator status-online"></span>
                    CO₂ Levels (Field 1)
                </h3>
                <div class="status-value" id="co2Value">
                    <span class="loading"></span>
                </div>
                <div class="chart-container">
                    <canvas id="co2Chart"></canvas>
                </div>
            </div>

            <!-- CH4 Before Purification -->
            <div class="card">
                <h3 class="card-title">
                    <span class="status-indicator status-warning"></span>
                    CH₄ Before Purification (Field 2)
                </h3>
                <div class="status-value" id="ch4BeforeValue">
                    <span class="loading"></span>
                </div>
                <div class="chart-container">
                    <canvas id="ch4BeforeChart"></canvas>
                </div>
            </div>

            <!-- Temperature -->
            <div class="card">
                <h3 class="card-title">
                    <span class="status-indicator status-online"></span>
                    Temperature (Field 3)
                </h3>
                <div class="status-value" id="tempValue">
                    <span class="loading"></span>
                </div>
                <div class="chart-container">
                    <canvas id="tempChart"></canvas>
                </div>
            </div>

            <!-- NaOH Mass -->
            <div class="card">
                <h3 class="card-title">
                    <span class="status-indicator status-online"></span>
                    NaOH Mass (Field 4)
                </h3>
                <div class="status-value" id="naohValue">
                    <span class="loading"></span>
                </div>
            </div>

            <!-- CH4 Comparison -->
            <div class="card" style="grid-column: span 2;">
                <h3 class="card-title">
                    <span class="status-indicator status-online"></span>
                    CH₄ Purification Comparison
                </h3>
                <div class="comparison-container">
                    <div class="comparison-item">
                        <h4>Before Purification</h4>
                        <div class="comparison-value comparison-before" id="ch4BeforeComp">
                            <span class="loading"></span>
                        </div>
                    </div>
                    <div class="comparison-arrow">→</div>
                    <div class="comparison-item">
                        <h4>After Purification</h4>
                        <div class="comparison-value comparison-after" id="ch4AfterComp">
                            <span class="loading"></span>
                        </div>
                    </div>
                </div>
                <div class="chart-container">
                    <canvas id="comparisonChart"></canvas>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ThingSpeak Configuration
        const CHANNEL_ID = '2983301';
        const READ_API_KEY = '3K7I9SHKTK6IGOAK';
        const WRITE_API_KEY = '94OC1P381MLH85S6';

        // Chart instances
        let charts = {};
        
        // Data storage
        let sensorData = {
            co2: [],
            ch4Before: [],
            temperature: [],
            naoh: [],
            timestamps: []
        };

        // Create animated background particles
        function createParticles() {
            const particlesContainer = document.getElementById('particles');
            for (let i = 0; i < 50; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = Math.random() * 100 + 'vw';
                particle.style.top = Math.random() * 100 + 'vh';
                particle.style.width = Math.random() * 10 + 5 + 'px';
                particle.style.height = particle.style.width;
                particle.style.animationDelay = Math.random() * 6 + 's';
                particle.style.animationDuration = (Math.random() * 3 + 3) + 's';
                particlesContainer.appendChild(particle);
            }
        }

        // Login functionality
        document.getElementById('loginForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const errorMessage = document.getElementById('errorMessage');
            const loginText = document.getElementById('loginText');
            const loginLoading = document.getElementById('loginLoading');
            
            // Show loading
            loginText.style.display = 'none';
            loginLoading.style.display = 'inline-block';
            
            setTimeout(() => {
                if (username === 'admin' && password === 'password') {
                    // Successful login
                    document.getElementById('loginPage').style.display = 'none';
                    document.getElementById('dashboardPage').style.display = 'block';
                    initializeDashboard();
                } else {
                    // Failed login
                    errorMessage.textContent = 'Invalid username or password!';
                    errorMessage.style.display = 'block';
                    loginText.style.display = 'inline';
                    loginLoading.style.display = 'none';
                    
                    // Hide error message after 3 seconds
                    setTimeout(() => {
                        errorMessage.style.display = 'none';
                    }, 3000);
                }
            }, 1500);
        });

        // Logout functionality
        function logout() {
            document.getElementById('dashboardPage').style.display = 'none';
            document.getElementById('loginPage').style.display = 'flex';
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
        }

        // Initialize dashboard
        function initializeDashboard() {
            createCharts();
            fetchSensorData();
            // Update data every 30 seconds
            setInterval(fetchSensorData, 30000);
        }

        // Fetch data from ThingSpeak
        async function fetchSensorData() {
            try {
                const response = await fetch(`https://api.thingspeak.com/channels/${CHANNEL_ID}/feeds.json?api_key=${READ_API_KEY}&results=20`);
                const data = await response.json();
                
                if (data.feeds && data.feeds.length > 0) {
                    // Process the data
                    sensorData.co2 = [];
                    sensorData.ch4Before = [];
                    sensorData.temperature = [];
                    sensorData.naoh = [];
                    sensorData.timestamps = [];
                    
                    data.feeds.forEach(feed => {
                        sensorData.co2.push(parseFloat(feed.field1) || 0);
                        sensorData.ch4Before.push(parseFloat(feed.field2) || 0);
                        sensorData.temperature.push(parseFloat(feed.field3) || 0);
                        sensorData.naoh.push(parseFloat(feed.field4) || 0);
                        sensorData.timestamps.push(new Date(feed.created_at).toLocaleTimeString());
                    });
                    
                    updateDashboard();
                }
            } catch (error) {
                console.error('Error fetching data:', error);
                // Use mock data if API fails
                generateMockData();
                updateDashboard();
            }
        }

        // Generate mock data for demonstration
        function generateMockData() {
            sensorData.co2 = [];
            sensorData.ch4Before = [];
            sensorData.temperature = [];
            sensorData.naoh = [];
            sensorData.timestamps = [];
            
            for (let i = 0; i < 20; i++) {
                sensorData.co2.push(Math.random() * 50 + 300);
                sensorData.ch4Before.push(Math.random() * 30 + 60);
                sensorData.temperature.push(Math.random() * 10 + 25);
                sensorData.naoh.push(Math.random() * 5 + 10);
                
                const time = new Date();
                time.setMinutes(time.getMinutes() - (20 - i) * 5);
                sensorData.timestamps.push(time.toLocaleTimeString());
            }
        }

        // Update dashboard with new data
        function updateDashboard() {
            const latestIndex = sensorData.co2.length - 1;
            
            // Update current values
            document.getElementById('co2Value').textContent = sensorData.co2[latestIndex]?.toFixed(1) + ' ppm';
            document.getElementById('ch4BeforeValue').textContent = sensorData.ch4Before[latestIndex]?.toFixed(1) + '%';
            document.getElementById('tempValue').textContent = sensorData.temperature[latestIndex]?.toFixed(1) + '°C';
            document.getElementById('naohValue').textContent = sensorData.naoh[latestIndex]?.toFixed(2) + ' g';
            
            // Calculate purified CH4 (simulated - typically 85-95% of original)
            const ch4After = sensorData.ch4Before[latestIndex] * (0.85 + Math.random() * 0.1);
            document.getElementById('ch4BeforeComp').textContent = sensorData.ch4Before[latestIndex]?.toFixed(1) + '%';
            document.getElementById('ch4AfterComp').textContent = ch4After?.toFixed(1) + '%';
            
            // Update charts
            updateCharts();
        }

        // Create charts
        function createCharts() {
            // CO2 Chart
            charts.co2 = new Chart(document.getElementById('co2Chart'), {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'CO₂ (ppm)',
                        data: [],
                        borderColor: '#e74c3c',
                        backgroundColor: 'rgba(231, 76, 60, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: getChartOptions('CO₂ Levels (ppm)')
            });

            // CH4 Before Chart
            charts.ch4Before = new Chart(document.getElementById('ch4BeforeChart'), {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'CH₄ (%)',
                        data: [],
                        borderColor: '#f39c12',
                        backgroundColor: 'rgba(243, 156, 18, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: getChartOptions('CH₄ Before Purification (%)')
            });

            // Temperature Chart
            charts.temperature = new Chart(document.getElementById('tempChart'), {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Temperature (°C)',
                        data: [],
                        borderColor: '#3498db',
                        backgroundColor: 'rgba(52, 152, 219, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: getChartOptions('Temperature (°C)')
            });

            // Comparison Chart
            charts.comparison = new Chart(document.getElementById('comparisonChart'), {
                type: 'bar',
                data: {
                    labels: ['Before Purification', 'After Purification'],
                    datasets: [{
                        label: 'CH₄ Percentage',
                        data: [0, 0],
                        backgroundColor: ['rgba(231, 76, 60, 0.8)', 'rgba(46, 204, 113, 0.8)'],
                        borderColor: ['#e74c3c', '#2ecc71'],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            ticks: {
                                callback: function(value) {
                                    return value + '%';
                                }
                            }
                        }
                    }
                }
            });
        }

        // Get chart options
        function getChartOptions(title) {
            return {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: false
                    }
                },
                scales: {
                    x: {
                        display: false
                    },
                    y: {
                        beginAtZero: true
                    }
                },
                elements: {
                    point: {
                        radius: 3,
                        hoverRadius: 6
                    }
                },
                interaction: {
                    intersect: false,
                    mode: 'index'
                }
            };
        }

        // Update charts with new data
        function updateCharts() {
            // Update CO2 chart
            charts.co2.data.labels = sensorData.timestamps.slice(-10);
            charts.co2.data.datasets[0].data = sensorData.co2.slice(-10);
            charts.co2.update('none');

            // Update CH4 Before chart
            charts.ch4Before.data.labels = sensorData.timestamps.slice(-10);
            charts.ch4Before.data.datasets[0].data = sensorData.ch4Before.slice(-10);
            charts.ch4Before.update('none');

            // Update Temperature chart
            charts.temperature.data.labels = sensorData.timestamps.slice(-10);
            charts.temperature.data.datasets[0].data = sensorData.temperature.slice(-10);
            charts.temperature.update('none');

            // Update Comparison chart
            const latestCH4 = sensorData.ch4Before[sensorData.ch4Before.length - 1];
            const purifiedCH4 = latestCH4 * (0.85 + Math.random() * 0.1);
            charts.comparison.data.datasets[0].data = [latestCH4, purifiedCH4];
            charts.comparison.update('none');
        }

        // Initialize the application
        window.addEventListener('load', function() {
            createParticles();
            generateMockData(); // Generate initial mock data
        });
    </script>
</body>
</html>

* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: 'Arial', sans-serif;
    background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
    min-height: 100vh;
    overflow-x: hidden;
}

/* Animated Background Particles */
.particles {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    z-index: -1;
}

.particle {
    position: absolute;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 50%;
    animation: float 6s ease-in-out infinite;
}

@keyframes float {
    0%, 100% { transform: translateY(0px) rotate(0deg); }
    50% { transform: translateY(-20px) rotate(180deg); }
}

/* Login Page Styles */
.login-container {
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
    padding: 20px;
}

.login-card {
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(20px);
    border-radius: 20px;
    padding: 40px;
    box-shadow: 0 25px 50px rgba(0, 0, 0, 0.25);
    width: 400px;
    transform: translateY(50px);
    opacity: 0;
    animation: slideIn 1s ease-out forwards;
}

@keyframes slideIn {
    to {
        transform: translateY(0);
        opacity: 1;
    }
}

.logo {
    text-align: center;
    margin-bottom: 30px;
}

.logo h1 {
    color: #27ae60;
    font-size: 2.5em;
    margin-bottom: 10px;
    background: linear-gradient(135deg, #27ae60, #2ecc71);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    animation: pulse 2s ease-in-out infinite;
}

@keyframes pulse {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.05); }
}

.logo p {
    color: #666;
    font-size: 1.1em;
}

.form-group {
    margin-bottom: 25px;
    position: relative;
}

.form-group input {
    width: 100%;
    padding: 15px;
    border: 2px solid #e0e0e0;
    border-radius: 10px;
    font-size: 16px;
    transition: all 0.3s ease;
    background: rgba(255, 255, 255, 0.8);
}

.form-group input:focus {
    outline: none;
    border-color: #27ae60;
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(39, 174, 96, 0.3);
}

.form-group label {
    position: absolute;
    top: 15px;
    left: 15px;
    color: #666;
    transition: all 0.3s ease;
    pointer-events: none;
}

.form-group input:focus + label,
.form-group input:valid + label {
    top: -10px;
    left: 10px;
    font-size: 12px;
    color: #27ae60;
    background: white;
    padding: 0 5px;
}

.login-btn {
    width: 100%;
    padding: 15px;
    background: linear-gradient(135deg, #27ae60, #2ecc71);
    color: white;
    border: none;
    border-radius: 10px;
    font-size: 16px;
    cursor: pointer;
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
}

.login-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 10px 25px rgba(39, 174, 96, 0.4);
}

.login-btn:active {
    transform: translateY(0);
}

.error-message {
    color: #e74c3c;
    text-align: center;
    margin-top: 15px;
    padding: 10px;
    border-radius: 5px;
    background: rgba(231, 76, 60, 0.1);
    display: none;
    animation: shake 0.5s ease-in-out;
}

@keyframes shake {
    0%, 100% { transform: translateX(0); }
    25% { transform: translateX(-5px); }
    75% { transform: translateX(5px); }
}

/* Dashboard Styles */
.dashboard {
    display: none;
    padding: 20px;
    animation: fadeIn 1s ease-out;
}

@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

.dashboard-header {
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(20px);
    border-radius: 20px;
    padding: 20px;
    margin-bottom: 20px;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.dashboard-title {
    color: #27ae60;
    font-size: 2em;
    font-weight: bold;
}

.exit-btn {
    background: linear-gradient(135deg, #e74c3c, #c0392b);
    color: white;
    border: none;
    padding: 12px 20px;
    border-radius: 10px;
    cursor: pointer;
    font-size: 16px;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    gap: 8px;
}

.exit-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(231, 76, 60, 0.4);
}

.dashboard-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
    gap: 20px;
}

.card {
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(20px);
    border-radius: 20px;
    padding: 25px;
    box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
    transition: all 0.3s ease;
}

.card:hover {
    transform: translateY(-5px);
    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
}

.card-title {
    font-size: 1.4em;
    color: #333;
    margin-bottom: 20px;
    display: flex;
    align-items: center;
    gap: 10px;
}

.status-value {
    font-size: 2.5em;
    font-weight: bold;
    color: #27ae60;
    text-align: center;
    margin: 20px 0;
    animation: countUp 2s ease-out;
}

@keyframes countUp {
    from { transform: scale(0.5); opacity: 0; }
    to { transform: scale(1); opacity: 1; }
}

.chart-container {
    position: relative;
    height: 250px;
    margin-top: 20px;
}

.status-indicator {
    display: inline-block;
    width: 12px;
    height: 12px;
    border-radius: 50%;
    margin-right: 8px;
    animation: blink 2s infinite;
}

.status-online {
    background: #2ecc71;
}

.status-warning {
    background: #f39c12;
}

.status-error {
    background: #e74c3c;
}

@keyframes blink {
    0%, 50% { opacity: 1; }
    51%, 100% { opacity: 0.3; }
}

.comparison-container {
    display: flex;
    justify-content: space-around;
    align-items: center;
    margin: 20px 0;
}

.comparison-item {
    text-align: center;
    flex: 1;
}

.comparison-value {
    font-size: 2em;
    font-weight: bold;
    margin: 10px 0;
}

.comparison-before {
    color: #e74c3c;
}

.comparison-after {
    color: #2ecc71;
}

.comparison-arrow {
    font-size: 2em;
    color: #27ae60;
    margin: 0 20px;
}

/* Loading Animation */
.loading {
    display: inline-block;
    width: 20px;
    height: 20px;
    border: 3px solid rgba(39, 174, 96, 0.3);
    border-radius: 50%;
    border-top-color: #27ae60;
    animation: spin 1s ease-in-out infinite;
}

@keyframes spin {
    to { transform: rotate(360deg); }
}

/* Responsive Design */
@media (max-width: 768px) {
    .dashboard-grid {
        grid-template-columns: 1fr;
    }
    
    .login-card {
        width: 90%;
        padding: 30px 20px;
    }
    
    .dashboard-header {
        flex-direction: column;
        gap: 15px;
        text-align: center;
    }
}


// ThingSpeak Configuration
const CHANNEL_ID = '2983301';
const READ_API_KEY = '3K7I9SHKTK6IGOAK';
const WRITE_API_KEY = '94OC1P381MLH85S6';

// Chart instances
let charts = {};

// Data storage
let sensorData = {
    co2: [],
    ch4Before: [],
    temperature: [],
    naoh: [],
    timestamps: []
};

// Create animated background particles
function createParticles() {
    const particlesContainer = document.getElementById('particles');
    for (let i = 0; i < 50; i++) {
        const particle = document.createElement('div');
        particle.className = 'particle';
        particle.style.left = Math.random() * 100 + 'vw';
        particle.style.top = Math.random() * 100 + 'vh';
        particle.style.width = Math.random() * 10 + 5 + 'px';
        particle.style.height = particle.style.width;
        particle.style.animationDelay = Math.random() * 6 + 's';
        particle.style.animationDuration = (Math.random() * 3 + 3) + 's';
        particlesContainer.appendChild(particle);
    }
}

// Login functionality
document.getElementById('loginForm').addEventListener('submit', function(e) {
    e.preventDefault();
    
    const username = document.getElementById('username').value;
    const password = document.getElementById('password').value;
    const errorMessage = document.getElementById('errorMessage');
    const loginText = document.getElementById('loginText');
    const loginLoading = document.getElementById('loginLoading');
    
    // Show loading
    loginText.style.display = 'none';
    loginLoading.style.display = 'inline-block';
    
    setTimeout(() => {
        if (username === 'admin' && password === 'password') {
            // Successful login
            document.getElementById('loginPage').style.display = 'none';
            document.getElementById('dashboardPage').style.display = 'block';
            initializeDashboard();
        } else {
            // Failed login
            errorMessage.textContent = 'Invalid username or password!';
            errorMessage.style.display = 'block';
            loginText.style.display = 'inline';
            loginLoading.style.display = 'none';
            
            // Hide error message after 3 seconds
            setTimeout(() => {
                errorMessage.style.display = 'none';
            }, 3000);
        }
    }, 1500);
});

// Logout functionality
function logout() {
    document.getElementById('dashboardPage').style.display = 'none';
    document.getElementById('loginPage').style.display = 'flex';
    document.getElementById('username').value = '';
    document.getElementById('password').value = '';
    
    // Clear update interval if exists
    if (window.dataUpdateInterval) {
        clearInterval(window.dataUpdateInterval);
    }
}

// Initialize dashboard
function initializeDashboard() {
    createCharts();
    fetchSensorData();
    // Update data every 30 seconds
    window.dataUpdateInterval = setInterval(fetchSensorData, 30000);
}

// Fetch data from ThingSpeak
async function fetchSensorData() {
    try {
        const response = await fetch(`https://api.thingspeak.com/channels/${CHANNEL_ID}/feeds.json?api_key=${READ_API_KEY}&results=20`);
        const data = await response.json();
        
        if (data.feeds && data.feeds.length > 0) {
            // Process the data
            sensorData.co2 = [];
            sensorData.ch4Before = [];
            sensorData.temperature = [];
            sensorData.naoh = [];
            sensorData.timestamps = [];
            
            data.feeds.forEach(feed => {
                sensorData.co2.push(parseFloat(feed.field1) || 0);
                sensorData.ch4Before.push(parseFloat(feed.field2) || 0);
                sensorData.temperature.push(parseFloat(feed.field3) || 0);
                sensorData.naoh.push(parseFloat(feed.field4) || 0);
                sensorData.timestamps.push(new Date(feed.created_at).toLocaleTimeString());
            });
            
            updateDashboard();
        }
    } catch (error) {
        console.error('Error fetching data:', error);
        // Use mock data if API fails
        generateMockData();
        updateDashboard();
    }
}

// Generate mock data for demonstration
function generateMockData() {
    sensorData.co2 = [];
    sensorData.ch4Before = [];
    sensorData.temperature = [];
    sensorData.naoh = [];
    sensorData.timestamps = [];
    
    for (let i = 0; i < 20; i++) {
        // Generate realistic biogas data
        sensorData.co2.push(Math.random() * 50 + 300);        // CO2: 300-350 ppm
        sensorData.ch4Before.push(Math.random() * 30 + 60);   // CH4: 60-90%
        sensorData.temperature.push(Math.random() * 10 + 25); // Temp: 25-35°C
        sensorData.naoh.push(Math.random() * 5 + 10);         // NaOH: 10-15g
        
        const time = new Date();
        time.setMinutes(time.getMinutes() - (20 - i) * 5);
        sensorData.timestamps.push(time.toLocaleTimeString());
    }
}

// Update dashboard with new data
function updateDashboard() {
    const latestIndex = sensorData.co2.length - 1;
    
    if (latestIndex >= 0) {
        // Update current values
        document.getElementById('co2Value').textContent = sensorData.co2[latestIndex]?.toFixed(1) + ' ppm';
        document.getElementById('ch4BeforeValue').textContent = sensorData.ch4Before[latestIndex]?.toFixed(1) + '%';
        document.getElementById('tempValue').textContent = sensorData.temperature[latestIndex]?.toFixed(1) + '°C';
        document.getElementById('naohValue').textContent = sensorData.naoh[latestIndex]?.toFixed(2) + ' g';
        
        // Calculate purified CH4 (simulated - typically 85-95% of original)
        const ch4After = sensorData.ch4Before[latestIndex] * (0.85 + Math.random() * 0.1);
        document.getElementById('ch4BeforeComp').textContent = sensorData.ch4Before[latestIndex]?.toFixed(1) + '%';
        document.getElementById('ch4AfterComp').textContent = ch4After?.toFixed(1) + '%';
        
        // Update charts
        updateCharts();
    }
}

// Create charts
function createCharts() {
    // CO2 Chart
    const co2Canvas = document.getElementById('co2Chart');
    if (co2Canvas) {
        charts.co2 = new Chart(co2Canvas, {
            type: 'line',
            data: {
                labels: [],
                datasets: [{
                    label: 'CO₂ (ppm)',
                    data: [],
                    borderColor: '#e74c3c',
                    backgroundColor: 'rgba(231, 76, 60, 0.1)',
                    tension: 0.4,
                    fill: true
                }]
            },
            options: getChartOptions('CO₂ Levels (ppm)')
        });
    }

    // CH4 Before Chart
    const ch4BeforeCanvas = document.getElementById('ch4BeforeChart');
    if (ch4BeforeCanvas) {
        charts.ch4Before = new Chart(ch4BeforeCanvas, {
            type: 'line',
            data: {
                labels: [],
                datasets: [{
                    label: 'CH₄ (%)',
                    data: [],
                    borderColor: '#f39c12',
                    backgroundColor: 'rgba(243, 156, 18, 0.1)',
                    tension: 0.4,
                    fill: true
                }]
            },
            options: getChartOptions('CH₄ Before Purification (%)')
        });
    }

    // Temperature Chart
    const tempCanvas = document.getElementById('tempChart');
    if (tempCanvas) {
        charts.temperature = new Chart(tempCanvas, {
            type: 'line',
            data: {
                labels: [],
                datasets: [{
                    label: 'Temperature (°C)',
                    data: [],
                    borderColor: '#3498db',
                    backgroundColor: 'rgba(52, 152, 219, 0.1)',
                    tension: 0.4,
                    fill: true
                }]
            },
            options: getChartOptions('Temperature (°C)')
        });
    }

    // Comparison Chart
    const comparisonCanvas = document.getElementById('comparisonChart');
    if (comparisonCanvas) {
        charts.comparison = new Chart(comparisonCanvas, {
            type: 'bar',
            data: {
                labels: ['Before Purification', 'After Purification'],
                datasets: [{
                    label: 'CH₄ Percentage',
                    data: [0, 0],
                    backgroundColor: ['rgba(231, 76, 60, 0.8)', 'rgba(46, 204, 113, 0.8)'],
                    borderColor: ['#e74c3c', '#2ecc71'],
                    borderWidth: 2
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: false
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        max: 100,
                        ticks: {
                            callback: function(value) {
                                return value + '%';
                            }
                        }
                    }
                }
            }
        });
    }
}

// Get chart options
function getChartOptions(title) {
    return {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
            legend: {
                display: false
            }
        },
        scales: {
            x: {
                display: false
            },
            y: {
                beginAtZero: true
            }
        },
        elements: {
            point: {
                radius: 3,
                hoverRadius: 6
            }
        },
        interaction: {
            intersect: false,
            mode: 'index'
        }
    };
}

// Update charts with new data
function updateCharts() {
    // Update CO2 chart
    if (charts.co2) {
        charts.co2.data.labels = sensorData.timestamps.slice(-10);
        charts.co2.data.datasets[0].data = sensorData.co2.slice(-10);
        charts.co2.update('none');
    }

    // Update CH4 Before chart
    if (charts.ch4Before) {
        charts.ch4Before.data.labels = sensorData.timestamps.slice(-10);
        charts.ch4Before.data.datasets[0].data = sensorData.ch4Before.slice(-10);
        charts.ch4Before.update('none');
    }

    // Update Temperature chart
    if (charts.temperature) {
        charts.temperature.data.labels = sensorData.timestamps.slice(-10);
        charts.temperature.data.datasets[0].data = sensorData.temperature.slice(-10);
        charts.temperature.update('none');
    }

    // Update Comparison chart
    if (charts.comparison && sensorData.ch4Before.length > 0) {
        const latestCH4 = sensorData.ch4Before[sensorData.ch4Before.length - 1];
        const purifiedCH4 = latestCH4 * (0.85 + Math.random() * 0.1);
        charts.comparison.data.datasets[0].data = [latestCH4, purifiedCH4];
        charts.comparison.update('none');
    }
}

// Send data to ThingSpeak (optional function for writing data)
async function sendDataToThingSpeak(field1, field2, field3, field4) {
    try {
        const url = `https://api.thingspeak.com/update?api_key=${WRITE_API_KEY}&field1=${field1}&field2=${field2}&field3=${field3}&field4=${field4}`;
        const response = await fetch(url);
        const result = await response.text();
        console.log('Data sent to ThingSpeak:', result);
        return result;
    } catch (error) {
        console.error('Error sending data to ThingSpeak:', error);
        return null;
    }
}

// Utility function to format numbers
function formatNumber(num, decimals = 1) {
    if (num === null || num === undefined || isNaN(num)) {
        return '0.0';
    }
    return parseFloat(num).toFixed(decimals);
}

// Update status indicators based on values
function updateStatusIndicators() {
    const co2Level = sensorData.co2[sensorData.co2.length - 1];
    const ch4Level = sensorData.ch4Before[sensorData.ch4Before.length - 1];
    const tempLevel = sensorData.temperature[sensorData.temperature.length - 1];
    
    // Update status indicators based on safe ranges
    updateIndicator('co2', co2Level, 400, 600); // CO2 safe range
    updateIndicator('ch4', ch4Level, 50, 95);   // CH4 safe range
    updateIndicator('temp', tempLevel, 20, 40); // Temperature safe range
}

// Update individual status indicator
function updateIndicator(type, value, minSafe, maxSafe) {
    const indicators = document.querySelectorAll('.status-indicator');
    indicators.forEach(indicator => {
        if (indicator.parentElement.textContent.toLowerCase().includes(type)) {
            indicator.className = 'status-indicator ';
            if (value >= minSafe && value <= maxSafe) {
                indicator.className += 'status-online';
            } else if (value < minSafe * 0.8 || value > maxSafe * 1.2) {
                indicator.className += 'status-error';
            } else {
                indicator.className += 'status-warning';
            }
        }
    });
}

// Calculate purification efficiency
function calculateEfficiency() {
    if (sensorData.ch4Before.length > 0) {
        const beforePurification = sensorData.ch4Before[sensorData.ch4Before.length - 1];
        const afterPurification = beforePurification * (0.85 + Math.random() * 0.1);
        const efficiency = ((afterPurification - beforePurification) / beforePurification * 100).toFixed(1);
        return Math.abs(efficiency);
    }
    return 0;
}

// Error handling for network issues
function handleNetworkError() {
    console.log('Network error detected, switching to mock data');
    generateMockData();
    updateDashboard();
}

// Initialize the application
window.addEventListener('load', function() {
    createParticles();
    generateMockData(); // Generate initial mock data
    
    // Check if Chart.js is loaded
    if (typeof Chart === 'undefined') {
        console.error('Chart.js not loaded. Please ensure Chart.js is included.');
    }
    
    console.log('BioPurifyTech Application Loaded Successfully!');
});

// Handle page visibility changes
document.addEventListener('visibilitychange', function() {
    if (document.hidden) {
        // Page is hidden, pause updates
        if (window.dataUpdateInterval) {
            clearInterval(window.dataUpdateInterval);
        }
    } else {
        // Page is visible, resume updates if on dashboard
        const dashboard = document.getElementById('dashboardPage');
        if (dashboard && dashboard.style.display === 'block') {
            window.dataUpdateInterval = setInterval(fetchSensorData, 30000);
        }
    }
});

// Global error handler
window.addEventListener('error', function(e) {
    console.error('Global error:', e.error);
    // Handle errors gracefully without breaking the app
});

// Cleanup function
function cleanup() {
    if (window.dataUpdateInterval) {
        clearInterval(window.dataUpdateInterval);
    }
    
    // Destroy charts if they exist
    Object.keys(charts).forEach(key => {
        if (charts[key]) {
            charts[key].destroy();
        }
    });
}

// Handle page unload
window.addEventListener('beforeunload', cleanup);